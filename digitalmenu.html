<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>المنيو الرقمي - جو كرسبي</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* ... (الأنماط تبقى كما هي) ... */
</style>
</head>
<body>

<div class="restaurant-header">
  <div class="restaurant-logo">
    <img src="images/profile.png" alt="جو كرسبي">
  </div>
  <h1>جو كرسبي</h1>
  <p>أشهى الوجبات المقرمشة والوجبات السريعة بجودة عالية</p>
  <p style="margin-top: 10px; color: #00a884; font-size: 14px;"><i class="fas fa-star"></i> 4.8 ★ (950 تقييم)</p>
</div>

<div class="menu-section">
  <h2><i class="fas fa-utensils"></i> قائمة الطعام</h2>
  
  <div class="menu-items" id="menuItems">
    <!-- Menu items will be loaded by JavaScript -->
  </div>
</div>

<div class="cart-summary">
  <h3><i class="fas fa-shopping-bag"></i> طلبك</h3>
  <div class="cart-items" id="cartItems">
    <div class="empty-cart" id="emptyCart">
      <i class="fas fa-shopping-basket"></i>
      <p>لم تقم بإضافة أي منتجات بعد</p>
    </div>
  </div>
  <div class="cart-total" id="cartTotal" style="display: none;">
    <div class="cart-total-label">الإجمالي</div>
    <div class="cart-total-amount" id="totalAmount">0 ريال</div>
  </div>
</div>

<div class="action-buttons">
  <a href="index.html" class="action-btn back-btn">
    <i class="fas fa-arrow-right"></i> العودة للواتساب
  </a>
  <button class="action-btn complete-order-btn disabled" id="completeOrderBtn">
    <i class="fas fa-check-circle"></i> إكمال الطلب
  </button>
</div>

<script>
// Menu items (same as in index.html)
const menuItems = [
  {
    id: 1,
    name: "وجبة لشخصين",
    description: "وجبة خاصة لشخصين مع مشروبات",
    price: 85,
    image: "images/item1.png"
  },
  {
    id: 2,
    name: "وجبة جو دجاج",
    description: "وجبة دجاج جو المقرمشة",
    price: 65,
    image: "images/item2.png"
  },
  {
    id: 3,
    name: "وجبة بينوي",
    description: "وجبة بينوي اللذيذة مع أصناف متنوعة",
    price: 75,
    image: "images/item3.png"
  },
  {
    id: 4,
    name: "وجبة الاحتفال",
    description: "وجبة احتفالية كبيرة مع جميع الأصناف",
    price: 120,
    image: "images/item4.png"
  },
  {
    id: 5,
    name: "وجبة جو دبل رويال",
    description: "وجبة جو رويال مزدوجة وفاخرة",
    price: 110,
    image: "images/item5.png"
  },
  {
    id: 6,
    name: "الوجبة القيمة",
    description: "وجبة اقتصادية مع قيمة ممتازة",
    price: 55,
    image: "images/item6.png"
  },
  {
    id: 7,
    name: "رويال ميل",
    description: "الوجبة الملكية مع جميع الإضافات",
    price: 95,
    image: "images/item7.png"
  },
  {
    id: 8,
    name: "وليمة أرز الدجاج الذهبي",
    description: "وليمة دجاج مع أرز ذهبي لذيذ",
    price: 130,
    image: "images/item8.png"
  },
  {
    id: 9,
    name: "وجبة السعادة",
    description: "وجبة تجلب السعادة مع أصناف مميزة",
    price: 70,
    image: "images/item9.png"
  },
  {
    id: 10,
    name: "باكيت تندر مع الجرافي",
    description: "باكيت تندر دجاج مع صوص الجرافي الخاص",
    price: 80,
    image: "images/item10.png"
  }
];

// Cart state
let cart = {};

// Initialize the menu
function initMenu() {
  const menuItemsContainer = document.getElementById('menuItems');
  
  menuItems.forEach(item => {
    const itemElement = document.createElement('div');
    itemElement.className = 'menu-item-card';
    itemElement.innerHTML = `
      <div class="menu-item-image">
        <img src="${item.image}" alt="${item.name}" onerror="this.src='images/item1.png'">
      </div>
      <div class="menu-item-content">
        <div class="menu-item-name">${item.name}</div>
        <div class="menu-item-desc">${item.description}</div>
        <div class="menu-item-footer">
          <div class="menu-item-price">${item.price} ريال</div>
          <div class="quantity-controls">
            <button class="quantity-btn minus-btn" onclick="updateQuantity(${item.id}, -1)">
              <i class="fas fa-minus"></i>
            </button>
            <div class="quantity-display" id="qty-${item.id}">0</div>
            <button class="quantity-btn plus-btn" onclick="updateQuantity(${item.id}, 1)">
              <i class="fas fa-plus"></i>
            </button>
          </div>
        </div>
      </div>
    `;
    
    menuItemsContainer.appendChild(itemElement);
  });
  
  updateCartDisplay();
}

// Update item quantity
function updateQuantity(itemId, change) {
  if (!cart[itemId]) {
    cart[itemId] = 0;
  }
  
  const newQuantity = cart[itemId] + change;
  
  if (newQuantity < 0) return;
  
  cart[itemId] = newQuantity;
  
  // Update quantity display
  const qtyDisplay = document.getElementById(`qty-${itemId}`);
  if (qtyDisplay) {
    qtyDisplay.textContent = newQuantity;
    
    // Update button states
    const card = qtyDisplay.closest('.menu-item-card');
    const minusBtn = card.querySelector('.minus-btn');
    if (minusBtn) {
      minusBtn.classList.toggle('disabled', newQuantity === 0);
    }
  }
  
  updateCartDisplay();
}

// Update cart display
function updateCartDisplay() {
  const cartItemsContainer = document.getElementById('cartItems');
  const emptyCartElement = document.getElementById('emptyCart');
  const cartTotalElement = document.getElementById('cartTotal');
  const totalAmountElement = document.getElementById('totalAmount');
  const completeOrderBtn = document.getElementById('completeOrderBtn');
  
  // Calculate cart items and total
  let itemsHTML = '';
  let total = 0;
  let itemCount = 0;
  
  Object.keys(cart).forEach(itemId => {
    const quantity = cart[itemId];
    if (quantity > 0) {
      const item = menuItems.find(i => i.id == itemId);
      if (item) {
        const itemTotal = item.price * quantity;
        total += itemTotal;
        itemCount += quantity;
        
        itemsHTML += `
          <div class="cart-item">
            <div class="cart-item-name">${item.name}</div>
            <div class="cart-item-quantity">${quantity} × ${item.price} ريال</div>
            <div class="cart-item-price">${itemTotal} ريال</div>
          </div>
        `;
      }
    }
  });
  
  // Show/hide empty cart message
  if (itemCount === 0) {
    emptyCartElement.style.display = 'block';
    cartTotalElement.style.display = 'none';
    completeOrderBtn.classList.add('disabled');
    completeOrderBtn.disabled = true;
  } else {
    emptyCartElement.style.display = 'none';
    cartTotalElement.style.display = 'flex';
    totalAmountElement.textContent = `${total} ريال`;
    completeOrderBtn.classList.remove('disabled');
    completeOrderBtn.disabled = false;
  }
  
  // Update cart items
  if (itemsHTML) {
    const existingItems = cartItemsContainer.querySelectorAll('.cart-item');
    existingItems.forEach(item => item.remove());
    cartItemsContainer.insertAdjacentHTML('afterbegin', itemsHTML);
  }
}

// Complete order and redirect to WhatsApp flow
function completeOrder() {
  if (Object.keys(cart).length === 0) return;
  
  // Prepare order data
  const orderData = {
    source: 'digitalmenu',
    items: cart, // استخدم الكارت مباشرة
    total: 0,
    itemCount: 0
  };
  
  // Calculate total and item count
  let itemsList = [];
  Object.keys(cart).forEach(itemId => {
    const quantity = cart[itemId];
    if (quantity > 0) {
      const item = menuItems.find(i => i.id == itemId);
      if (item) {
        orderData.total += item.price * quantity;
        orderData.itemCount += quantity;
        itemsList.push(`${itemId}:${quantity}:${item.price}:${item.name}`);
      }
    }
  });
  
  if (orderData.itemCount === 0) return;
  
  // إنشاء رابط مع البيانات
  const itemsParam = itemsList.join('|'); // تنسيق: 1:2:85:وجبة لشخصين|2:1:65:وجبة جو دجاج
  const url = `index.html?digitalmenu=1&items=${encodeURIComponent(itemsParam)}&total=${orderData.total}&count=${orderData.itemCount}`;
  
  // الانتقال إلى صفحة الواتساب
  window.location.href = url;
}

// Initialize
window.onload = function() {
  initMenu();
  
  // Add event listener to complete order button
  document.getElementById('completeOrderBtn').addEventListener('click', completeOrder);
};
</script>
</body>
</html>
